This is the code for “SMOG: Accelerating Subgraph Matching on GPUs”, which won the GraphChallenge 2023 champion.

## Environment

CUDA Toolkit 11.6; gcc version 11.1.0; mpiexec (OpenRTE) 2.1.1; MPICH Version:3.3a2; Python 3.10.9

## Dataset

Run  `./run.sh ` in data folder, or you can create any specified folder for data

Dataset source from : http://graphchallenge.mit.edu/data-sets

The optional patterns are shown below


![pattern](https://github.com/mengziheng/Gpu-SubgraphIsomorphism/assets/121283369/c47c8f22-075c-4ea7-9286-ed0b214de22a)



## Preprocess 

include preprocess script for H-index , Trust , SMOG

SMOG is in preprocess/SMOG

All preprocess script is preprocess.py

preprocess graph : 
    `python preprocess.py ../../data/graph ../../data/processed_graph`

The input arguments is 
1. input graph folder (include all graph to be preprocessed)
2. output graph folder (include all graph already preprocessed)

## Compile and Run code
Before running the following code, you need to preprocess the graph first. See the preprocess part above

Run the srcipt in SMOG folder
    `python script.py --input_graph_folder ../data/processed_graph/amazon0302 --input_pattern Q2`

input_graph_folder and input_pattern are required, and there are also other parameters you can choose to change：

--N : numbers of GPU

--load_factor : load factor for hash table

--bucket_size : bucket size for hash table

--block_number_for_kernel : number of block for subgraph match kernel

--block_size_for_kernel : size of block for subgraph match kernel

--chunk_size : chunk size for task assignment

## Experiment 
Include experiment script for H-index , Trust , SMOG

Experiment for Trust and Hindex: 
    `python performance_benchmark.py /data/zh_dataset/Hindex_processed_graph_challenge_dataset/snap`

If you want to test the results of all graphs and all patterns on SMOG, you can execute 
    `python pattern.py`
You can change the contents of pattern.py to modify the graph and pattern to be tested and the path to the output file

If you want to test the results on different numbers of GPUs, you can execute 
    `python scalability.py` 
in scalability folder, you can change the contents of scalability.py to modify the pattern and numbers of GPUs to be tested and the path to the output file. You can also change the contents of graph_dataset.txt to modify the graphs to be tested

## Contact
Please send me a email if you have any questions: zhmeng.cn@gmail.com or wzbwangzhibin@gmail.com

## Results

### Triangle
| graph_name               | time    | count      |
|--------------------------|---------|------------|
| amazon0302               | 0.756   | 717719     |
| amazon0312               | 1.53    | 3686467    |
| amazon0505               | 1.911   | 3951063    |
| amazon0601               | 2.213   | 3986507    |
| as-caida20071105         | 0.074   | 36365      |
| as20000102               | 0.04    | 6584       |
| ca-AstroPh               | 0.174   | 1351441    |
| ca-CondMat               | 0.083   | 173361     |
| ca-GrQc                  | 0.038   | 48260      |
| ca-HepPh                 | 0.156   | 3678962    |
| ca-HepTh                 | 0.04    | 28339      |
| cit-HepPh                | 0.41    | 1276868    |
| cit-HepTh                | 0.324   | 1478735    |
| cit-Patents              | 16.017  | 7515023    |
| email-Enron              | 0.165   | 727044     |
| email-EuAll              | 0.095   | 267313     |
| facebook_combined        | 0.089   | 1612010    |
| flickrEdges              | 4.43    | 80265588   |
| loc-brightkite_edges     | 0.118   | 494728     |
| loc-gowalla_edges        | 0.97    | 2273138    |
| oregon1_010331           | 0.04    | 17144      |
| oregon1_010407           | 0.031   | 15834      |
| oregon1_010414           | 0.039   | 18237      |
| oregon1_010421           | 0.033   | 19108      |
| oregon1_010428           | 0.045   | 17645      |
| oregon1_010505           | 0.04    | 17597      |
| oregon1_010512           | 0.038   | 17598      |
| oregon1_010519           | 0.042   | 17677      |
| oregon1_010526           | 0.04    | 19894      |
| oregon2_010331           | 0.035   | 82856      |
| oregon2_010407           | 0.045   | 78138      |
| oregon2_010414           | 0.04    | 88905      |
| oregon2_010421           | 0.039   | 82129      |
| oregon2_010428           | 0.039   | 78000      |
| oregon2_010505           | 0.042   | 72182      |
| oregon2_010512           | 0.04    | 72866      |
| oregon2_010519           | 0.036   | 83709      |
| oregon2_010526           | 0.033   | 89541      |
| p2p-Gnutella04           | 0.054   | 934        |
| p2p-Gnutella05           | 0.037   | 1112       |
| p2p-Gnutella06           | 0.043   | 1142       |
| p2p-Gnutella08           | 0.037   | 2383       |
| p2p-Gnutella09           | 0.039   | 2354       |
| p2p-Gnutella24           | 0.062   | 986        |
| p2p-Gnutella25           | 0.066   | 806        |
| p2p-Gnutella30           | 0.1     | 1590       |
| p2p-Gnutella31           | 0.12    | 2024       |
| roadNet-CA               | 2.261   | 120676     |
| roadNet-PA               | 0.758   | 67150      |
| roadNet-TX               | 1.262   | 82869      |
| soc-Epinions1            | 0.41    | 1624481    |
| soc-Slashdot0811         | 0.359   | 551724     |
| soc-Slashdot0902         | 0.391   | 602592     |
| 201512012345             | 0.574   | 2          |
| 201512020000             | 1.131   | 2          |
| 201512020030             | 2.72    | 6          |
| 201512020130             | 6.575   | 10         |
| 201512020330             | 0.024   | 50         |
| P1a                      | 77.014  | 3412       |
| Theory-16-25-81-B1k      | 0.103   | 133321     |
| Theory-16-25-81-B2k      | 0.057   | 7          |
| Theory-16-25-B1k         | 0.04    | 400        |
| Theory-16-25-B2k         | 0.023   | 1          |
| Theory-25-81-256-B1k     | 1.008   | 2102761    |
| Theory-25-81-256-B2k     | 0.537   | 7          |
| Theory-25-81-B1k         | 0.026   | 2025       |
| Theory-25-81-B2k         | 0.03    | 1          |
| Theory-256-625-B1k       | 0.087   | 160000     |
| Theory-256-625-B2k       | 0.092   | 1          |
| Theory-3-4-5-9-16-25-B1k | 17.375  | 35882427   |
| Theory-3-4-5-9-16-25-B2k | 5.589   | 651        |
| Theory-3-4-5-9-16-B1k    | 0.194   | 465427     |
| Theory-3-4-5-9-16-B2k    | 0.101   | 155        |
| Theory-3-4-5-9-B1k       | 0.027   | 9107       |
| Theory-3-4-5-9-B2k       | 0.031   | 35         |
| Theory-3-4-5-B1k         | 0.022   | 287        |
| Theory-3-4-5-B2k         | 0.021   | 7          |
| Theory-3-4-B1k           | 0.018   | 12         |
| Theory-3-4-B2k           | 0.018   | 1          |
| Theory-4-5-9-16-25-B1k   | 1.367   | 3548463    |
| Theory-4-5-9-16-25-B2k   | 0.631   | 155        |
| Theory-4-5-9-16-B1k      | 0.028   | 45013      |
| Theory-4-5-9-16-B2k      | 0.033   | 35         |
| Theory-4-5-9-B1k         | 0.043   | 821        |
| Theory-4-5-9-B2k         | 0.022   | 7          |
| Theory-4-5-B1k           | 0.017   | 20         |
| Theory-4-5-B2k           | 0.019   | 1          |
| Theory-5-9-16-25-81-B1k  | 31.765  | 66758995   |
| Theory-5-9-16-25-81-B2k  | 11.576  | 155        |
| Theory-5-9-16-25-B1k     | 0.148   | 264799     |
| Theory-5-9-16-25-B2k     | 0.08    | 35         |
| Theory-5-9-16-B1k        | 0.037   | 3149       |
| Theory-5-9-16-B2k        | 0.023   | 7          |
| Theory-5-9-B1k           | 0.019   | 45         |
| Theory-5-9-B2k           | 0.03    | 1          |
| Theory-81-256-B1k        | 0.025   | 20736      |
| Theory-81-256-B2k        | 0.022   | 1          |
| Theory-9-16-25-81-B1k    | 2.785   | 4059175    |
| Theory-9-16-25-81-B2k    | 1.157   | 35         |
| Theory-9-16-25-B1k       | 0.038   | 15169      |
| Theory-9-16-25-B2k       | 0.027   | 7          |
| Theory-9-16-B1k          | 0.025   | 144        |
| Theory-9-16-B2k          | 0.03    | 1          |
| U1a                      | 35.199  | 325        |
| V1r                      | 116.597 | 49         |
| V2a                      | 30.296  | 1443       |
| graph500-scale18-ef16    | 7.198   | 82287285   |
| graph500-scale19-ef16    | 20.36   | 186288972  |
| graph500-scale20-ef16    | 57.162  | 419349784  |
| graph500-scale21-ef16    | 153.247 | 935100883  |
| graph500-scale22-ef16    | 423.084 | 2067392370 |
| graph500-scale23-ef16    | 1109.78 | 4549133002 |
| graph500-scale24-ef16    | 2883.68 | 9936161560 |


### Other pattern
| Graph/Pattern        | Q1 count    | Q2 count    | Q3 count  | Q4 count    | Q5 count   | Q6 count    | Q7 count  | Q8 count   |
|----------------------|-------------|-------------|-----------|-------------|------------|-------------|------------|-------------|
| amazon0302           | 2477087     | 3110467     | 304441    | 4915256     | 67942      | 6405886     | 6267       | 2891271     |
| amazon0312           | 32229022    | 40921800    | 3975712   | 202015989   | 3187886    | 249735343   | 1920570    | 126529077   |
| amazon0505           | 35492004    | 45276121    | 4361282   | 229617605   | 3543622    | 282891801   | 2147049    | 141362172   |
| amazon0601           | 35661461    | 45701006    | 4420994   | 232448240   | 3606466    | 285794903   | 2193997    | 143515707   |
| as20000102           | 288840      | 287940      | 5636      | 1452941     | 5900       | 1773657     | 4779       | 410823      |
| as-caida20071105     | 2287349     | 2042272     | 53875     | 16546241    | 82231      | 23868747    | 102147     | 5221539     |
| ca-AstroPh           | 44916549    | 72355715    | 9580415   | 2545573891  | 64997961   | 2732693146  | 400401488  | 2115036981  |
| ca-CondMat           | 1505383     | 2349650     | 294008    | 21403215    | 511088     | 23018710    | 919604     | 16737753    |
| ca-GrQc              | 1054723     | 2041499     | 329297    | 68885210    | 2215500    | 69763367    | 12898478   | 67338180    |
| ca-HepPh             | 507961441   | 976450063   | 156497775 | 2.0414E+11  | 6608523653 | 2.05227E+11 |            | 1.99285E+11 |
| ca-HepTh             | 239081      | 429013      | 65592     | 8479804     | 279547     | 8518817     | 1123584    | 8407782     |
| cit-HepPh            | 39015537    | 36512540    | 2562245   | 429991999   | 4262265    | 647492608   | 6262553    | 209197863   |
| cit-HepTh            | 63698507    | 61934120    | 4113289   | 967443899   | 9380530    | 1386675032  | 19927580   | 439990809   |
| cit-Patents          | 341906226   | 83785566    | 3501071   | 446804010   | 3039636    | 1776150458  | 3151595    | 214057482   |
| email-Enron          | 36256665    | 36528276    | 2341639   | 720230791   | 5809356    | 1018877581  | 11213163   | 303894917   |
| email-EuAll          | 17093921    | 12663071    | 581032    | 105766262   | 1101520    | 217531995   | 1633335    | 34119119    |
| facebook_combined    | 144023053   | 228787050   | 30004668  | 21763153227 | 517965151  | 25095227541 | 7830937838 | 18073550424 |
| flickrEdges          | 23124971168 | 37701640669 | 47798166  | 31234180596 | 47798166   | 37701640669 | 47798166   | 62468361192 |
| loc-brightkite_edges | 23380701    | 29261679    | 2851308   | 1141663792  | 19481391   | 1412668691  | 117409296  | 770479983   |
| loc-gowalla_edges    | 146652712   | 122513526   | 6086852   | 2385052206  | 14570875   | 3649782390  | 28928240   | 843084102   |
| oregon1_010331       | 882711      | 903673      | 26610     | 7201602     | 48224      | 8920546     | 74010      | 2584989     |
| oregon1_010407       | 862089      | 856275      | 19339     | 5631882     | 25558      | 7079906     | 27610      | 1653027     |
| oregon1_010414       | 1047953     | 1062429     | 27135     | 8464828     | 43369      | 10585976    | 58353      | 2715672     |
| oregon1_010421       | 1086538     | 1104592     | 29766     | 9095735     | 48256      | 11473075    | 63557      | 2981766     |
| oregon1_010428       | 1039416     | 1056059     | 26461     | 8426215     | 43111      | 10532050    | 57397      | 2697855     |
| oregon1_010505       | 1029499     | 1044752     | 26032     | 8190827     | 41425      | 10266580    | 53748      | 2617554     |
| oregon1_010512       | 1029394     | 1044280     | 26021     | 8167375     | 42024      | 10227080    | 56363      | 2619801     |
| oregon1_010519       | 1036037     | 1053528     | 26855     | 8422989     | 45008      | 10522786    | 62383      | 2752923     |
| oregon1_010526       | 1127118     | 1143939     | 30479     | 9287382     | 46025      | 11810065    | 54635      | 2979066     |
| oregon2_010331       | 3864085     | 4534433     | 346110    | 96857189    | 1225487    | 128199789   | 3486756    | 55375107    |
| oregon2_010407       | 3676432     | 4274174     | 310832    | 86547287    | 1018894    | 114316252   | 2589878    | 47372241    |
| oregon2_010414       | 4395393     | 5168925     | 384812    | 114632553   | 1357613    | 150875771   | 3732350    | 63016083    |
| oregon2_010421       | 4034908     | 4669252     | 328075    | 96542004    | 1057622    | 127655123   | 2612910    | 50902146    |
| oregon2_010428       | 3850923     | 4393556     | 296111    | 87226143    | 914846     | 116021694   | 2184648    | 45054363    |
| oregon2_010505       | 3515244     | 3997732     | 265128    | 76793351    | 803624     | 101907997   | 1886911    | 39614316    |
| oregon2_010512       | 3563170     | 4054385     | 267660    | 78501518    | 819849     | 103741974   | 1964260    | 40337997    |
| oregon2_010519       | 4260328     | 4940921     | 343439    | 106661610   | 1170508    | 139293097   | 3140226    | 56056512    |
| oregon2_010526       | 4682574     | 5550489     | 399013    | 130655968   | 1500920    | 167586606   | 4496036    | 70406592    |
| p2p-Gnutella04       | 28497       | 750         | 3         | 6           | 0          | 1695        | 0          | 0           |
| p2p-Gnutella05       | 64998       | 4928        | 55        | 3237        | 0          | 22537       | 0          | 696         |
| p2p-Gnutella06       | 90764       | 8477        | 45        | 2788        | 0          | 65486       | 0          | 543         |
| p2p-Gnutella08       | 87885       | 15822       | 175       | 7544        | 6          | 48937       | 0          | 999         |
| p2p-Gnutella09       | 96902       | 15472       | 160       | 7577        | 6          | 48445       | 0          | 1068        |
| p2p-Gnutella24       | 8794        | 498         | 11        | 26          | 0          | 178         | 0          | 3           |
| p2p-Gnutella25       | 13517       | 410         | 7         | 24          | 0          | 166         | 0          | 3           |
| p2p-Gnutella30       | 46363       | 1109        | 13        | 42          | 0          | 1558        | 0          | 9           |
| p2p-Gnutella31       | 42466       | 922         | 16        | 40          | 0          | 592         | 0          | 6           |
| roadNet-CA           | 262339      | 12869       | 42        | 1           | 0          | 1373        | 0          | 0           |
| roadNet-PA           | 157802      | 5858        | 21        | 1           | 0          | 299         | 0          | 0           |
| roadNet-TX           | 183252      | 7494        | 32        | 2           | 0          | 476         | 0          | 0           |
| soc-Epinions1        | 166635817   | 112509146   | 5803397   | 2578196450  | 17417432   | 4729789840  | 45703641   | 997173396   |
| soc-Slashdot0811     | 49965153    | 28774497    | 1989958   | 870174916   | 10667149   | 1259485940  | 46754083   | 484393905   |
| soc-Slashdot0902     | 58678630    | 34060778    | 2260269   | 1027371282  | 12596328   | 1477856348  | 57879044   | 569811453   |


| Graph/Pattern        | Q1 time | Q2 time | Q3 time | Q4 time  | Q5 time  | Q6 time  | Q7 time   | Q8 time  |
|----------------------|---------|---------|---------|----------|----------|----------|-----------|----------|
| amazon0302           | 1.71    | 3.10    | 1.56    | 5.52     | 1.76     | 10.48    | 1.29      | 4.90     |
| amazon0312           | 9.45    | 14.53   | 4.25    | 28.34    | 9.89     | 130.65   | 7.73      | 30.63    |
| amazon0505           | 10.16   | 15.68   | 6.79    | 57.19    | 9.52     | 158.15   | 10.76     | 43.84    |
| amazon0601           | 10.13   | 15.90   | 6.40    | 54.31    | 7.18     | 159.38   | 11.65     | 44.80    |
| as20000102           | 0.22    | 0.33    | 0.20    | 4.34     | 0.52     | 112.56   | 1.11      | 3.50     |
| as-caida20071105     | 1.35    | 0.85    | 0.51    | 12.12    | 1.95     | 375.21   | 7.85      | 7.71     |
| ca-AstroPh           | 3.63    | 5.48    | 2.23    | 80.89    | 23.32    | 249.38   | 276.73    | 71.35    |
| ca-CondMat           | 0.48    | 0.67    | 0.61    | 4.88     | 3.13     | 32.56    | 21.60     | 6.14     |
| ca-GrQc              | 0.54    | 0.66    | 1.41    | 18.71    | 16.17    | 32.90    | 114.13    | 23.05    |
| ca-HepPh             | 19.12   | 23.05   | 10.77   | 2,279.05 | 1,079.01 | 5,097.84 | 58,196.40 | 2,022.72 |
| ca-HepTh             | 0.26    | 0.34    | 0.81    | 6.63     | 4.12     | 11.00    | 32.68     | 8.97     |
| cit-HepPh            | 6.35    | 6.56    | 2.45    | 404.93   | 8.88     | 508.29   | 53.10     | 99.02    |
| cit-HepTh            | 8.08    | 8.13    | 2.37    | 93.05    | 31.53    | 3,662.77 | 77.76     | 60.02    |
| cit-Patents          | 76.15   | 60.30   | 18.54   | 0.09     | 0.04     | 534.03   | 0.04      | 0.10     |
| email-Enron          | 5.31    | 4.47    | 1.11    | 173.80   | 3.95     | 338.50   | 20.14     | 78.58    |
| email-EuAll          | 7.88    | 3.46    | 1.25    | 1,131.66 | 11.04    | 583.88   | 34.23     | 288.12   |
| facebook_combined    | 8.57    | 7.92    | 3.71    | 384.89   | 140.25   | 890.78   | 2,720.43  | 333.04   |
| loc-brightkite_edges | 3.05    | 3.31    | 1.11    | 106.02   | 17.98    | 340.54   | 191.01    | 90.40    |
| loc-gowalla_edges    | 22.01   | 24.08   | 4.07    | 337.87   | 11.83    | 2,861.60 | 49.90     | 118.70   |
| oregon1_010331       | 0.46    | 0.57    | 0.33    | 12.73    | 1.69     | 271.82   | 7.49      | 7.92     |
| oregon1_010407       | 0.42    | 0.43    | 0.36    | 9.63     | 1.39     | 280.32   | 4.27      | 5.81     |
| oregon1_010414       | 0.50    | 0.49    | 0.41    | 15.63    | 2.21     | 277.97   | 5.68      | 7.64     |
| oregon1_010421       | 0.48    | 0.46    | 0.33    | 10.09    | 1.01     | 275.36   | 3.40      | 5.89     |
| oregon1_010428       | 0.60    | 0.75    | 0.45    | 16.18    | 1.60     | 282.20   | 5.44      | 9.15     |
| oregon1_010505       | 0.57    | 0.51    | 0.30    | 12.76    | 1.35     | 272.28   | 3.50      | 7.96     |
| oregon1_010512       | 0.49    | 0.52    | 0.45    | 9.74     | 1.70     | 269.10   | 5.63      | 5.78     |
| oregon1_010519       | 0.51    | 0.50    | 0.39    | 15.40    | 1.64     | 275.33   | 4.58      | 7.53     |
| oregon1_010526       | 0.50    | 0.49    | 0.33    | 15.06    | 1.33     | 282.77   | 3.96      | 7.84     |
| oregon2_010331       | 0.92    | 0.84    | 0.64    | 18.04    | 5.67     | 280.95   | 32.16     | 15.46    |
| oregon2_010407       | 1.42    | 1.33    | 0.92    | 25.20    | 4.55     | 282.13   | 25.33     | 15.72    |
| oregon2_010414       | 0.95    | 0.72    | 0.55    | 19.95    | 3.35     | 281.64   | 21.75     | 11.78    |
| oregon2_010421       | 0.86    | 0.77    | 0.75    | 19.01    | 3.02     | 281.46   | 15.36     | 10.23    |
| oregon2_010428       | 0.78    | 0.68    | 0.72    | 19.01    | 3.76     | 284.47   | 13.97     | 10.22    |
| oregon2_010505       | 0.94    | 0.89    | 0.61    | 22.80    | 3.57     | 281.63   | 19.65     | 12.05    |
| oregon2_010512       | 0.81    | 0.69    | 0.49    | 27.72    | 3.42     | 277.25   | 22.01     | 14.30    |
| oregon2_010519       | 0.98    | 1.06    | 0.80    | 35.72    | 4.43     | 287.40   | 20.75     | 14.79    |
| oregon2_010526       | 1.00    | 0.74    | 0.87    | 20.17    | 5.88     | 297.82   | 36.05     | 16.09    |
| p2p-Gnutella04       | 0.33    | 0.12    | 0.07    | 0.14     | 0.09     | 0.28     | 0.08      | 0.12     |
| p2p-Gnutella05       | 0.20    | 0.10    | 0.05    | 0.23     | 0.07     | 1.84     | 0.07      | 0.21     |
| p2p-Gnutella06       | 0.19    | 0.12    | 0.06    | 0.31     | 0.08     | 2.35     | 0.09      | 0.24     |
| p2p-Gnutella08       | 0.23    | 0.09    | 0.07    | 0.14     | 0.09     | 1.68     | 0.06      | 0.14     |
| p2p-Gnutella24       | 0.29    | 0.14    | 0.08    | 0.18     | 0.10     | 0.16     | 0.07      | 0.15     |
| p2p-Gnutella25       | 0.32    | 0.16    | 0.09    | 0.19     | 0.10     | 0.19     | 0.12      | 0.18     |
| p2p-Gnutella30       | 0.25    | 0.14    | 0.07    | 0.18     | 0.12     | 0.14     | 0.08      | 0.14     |
| p2p-Gnutella31       | 0.49    | 0.20    | 0.13    | 0.17     | 0.17     | 0.21     | 0.12      | 0.16     |
| roadNet-CA           | 4.03    | 6.71    | 2.73    | 5.04     | 2.85     | 4.67     | 3.14      | 4.84     |
| roadNet-PA           | 1.31    | 2.25    | 1.30    | 1.65     | 1.59     | 1.54     | 1.26      | 1.60     |
| roadNet-TX           | 1.63    | 2.97    | 1.60    | 2.85     | 1.76     | 1.87     | 1.76      | 1.94     |
| soc-Epinions1        | 21.13   | 18.14   | 4.19    | 91.89    | 22.48    | 942.38   | 119.82    | 66.74    |
| soc-Slashdot0811     | 15.39   | 8.89    | 2.26    | 60.92    | 17.17    | 541.72   | 102.73    | 56.82    |
| soc-Slashdot0902     | 17.68   | 13.57   | 1.98    | 81.13    | 18.14    | 2,436.55 | 173.90    | 66.00    |

